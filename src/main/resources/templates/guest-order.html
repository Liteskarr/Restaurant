<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Restaurant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
</head>
<body>

<div class="container-fluid">
    <div th:if="${error} != null" class="row alert alert-danger alert-dismissible fade show m-2" role="alert">
        <strong>User-side error:</strong>
        <p th:text="${error}"></p>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="row">
        <form class="container-fluid row text-center" th:method="POST" th:action="@{/guest}">
            <button class="col btn btn-info m-1" name="operation" value="update">Update</button>
            <button th:if="${orderState} == ${'OPENED'}" class="col btn btn-primary m-1" name="operation"
                    value="make">
                Make Order
            </button>
            <button th:unless="${orderState} == ${'OPENED'}" class="col btn disabled m-1">
                Make Order
            </button>
            <button th:if="${orderState} == ${'IN_PROGRESS'}" class="col btn btn-danger m-1" name="operation"
                    value="cancel">
                Cancel
            </button>
            <button th:unless="${orderState} == ${'IN_PROGRESS'}" class="col btn btn-danger disabled m-1">
                Cancel
            </button>
            <button th:if="${orderState} == ${'DONE'}" class="col btn btn-primary m-1" name="operation"
                    value="pay">
                Pay
            </button>
            <button th:unless="${orderState} == ${'DONE'}" class="col btn disabled m-1">
                Pay
            </button>
        </form>
    </div>

    <div class="row">
        <div class="container-fluid text-center">
            <div class="row">
                <div class="col">
                    <div class="m-2">
                        <h2>Menu</h2>
                        <div th:each="dish,dishStat : ${dishes}">
                            <form class="container-fluid text-center align-items-center row row-col-2 m-1"
                                  th:method="POST" th:action="@{'/guest/add/' + ${dish.id}}" th:object="${dish}">
                                <p class="col m-1 fs-5" th:text="*{desc}">Hedgehog with salad (50$, 10
                                    minute)</p>
                                <button th:if="${orderState == 'OPENED' || orderState == 'IN_PROGRESS'}"
                                        class="col-2 btn btn-success" type="submit">
                                    Add
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="container-fluid text-center m-2">
                        <h2>Order <th:block th:text="${orderState}"></th:block></h2>
                        <div th:if="${orderState} == ${'IN_PROGRESS'}" class="row progress"
                             role="progressbar" th:attr="aria-valuenow=${progress}" aria-valuemin="0"
                             aria-valuemax="100" aria-label="Example 20px high">
                            <div class="progress-bar" th:text="${progress} + '%'"
                                 th:style="'width: ' + ${progress} + '%'">
                            </div>
                        </div>
                        <div th:if="${orderState} == ${'DONE'}" class="row progress" role="progressbar"
                             aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" aria-label="Example 20px high">
                            <div class="progress-bar bg-success" style="width: 100%"></div>
                        </div>
                        <div class="row text-center" th:text="'Cost of order: ' + ${costOfOrder} + '$'"></div>
                        <div class="row" th:each="dish,dishStat : ${orderedDishes}">
                            <form class="container-fluid text-center align-items-center row row-col-2 m-1"
                                  th:method="POST" th:action="@{'/guest/delete/' + ${dish.id}}" th:object="${dish}">
                                <p class="col m-1 fs-5" th:text="*{desc}"></p>
                                <button th:if="${orderState} == ${'OPENED'}" type="submit"
                                        class="col-2 btn btn-success">Remove
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>